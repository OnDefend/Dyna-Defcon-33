---
# AODS Comprehensive Vulnerability Pattern Configuration
# Organic detection patterns for mobile application security analysis

version: "4.1"
last_updated: "2025-07-31"

# ========================================
# GLOBAL EXCLUSION PATTERNS (Applied to ALL patterns)
# ========================================
global_exclusions:
  # INTELLIGENT EXCLUSIONS: These patterns trigger intelligent filtering, not blanket exclusion
  # The filtering logic will preserve real vulnerabilities even in these contexts
  
  # Test/debug/sample code - but preserve vulnerabilities that could affect production
  - ".*(?:test|Test|TEST|debug|Debug|DEBUG|sample|Sample|SAMPLE|example|Example|EXAMPLE|demo|Demo|DEMO).*"
  
  # Kotlin compiler artifacts - but preserve actual vulnerabilities in Kotlin code
  - ".*\\$\\$serializer.*|.*\\$Companion.*|.*\\$WhenMappings.*|.*\\$DefaultImpls.*"
  
  # Library paths - but preserve vulnerable library usage (network, crypto, etc.)
  - ".*/(?:androidx|android/support|com/google|com/facebook|com/squareup|org/apache|kotlin|kotlinx)/.*"
  
  # Build and configuration files - but preserve config vulnerabilities (debuggable, secrets, etc.)
  - ".*\\.(?:gradle|pro|txt)$"
  
  # Resource layout files - but preserve exported components and sensitive configs
  - ".*/res/(?:layout|drawable|mipmap)/.*"
  
  # Generated R.java files - these are usually noise
  - ".*/R\\.java$|.*/BuildConfig\\.java$"

# ========================================
# MANIFEST-BASED VULNERABILITIES
# ========================================

manifest_security:
  android_debuggable:
    patterns:
      - id: "manifest_debug_001"
        pattern: "android:debuggable\\s*=\\s*[\"']true[\"']"
        severity: "HIGH"
        cwe_id: "CWE-489"
        owasp_category: "M10: Extraneous Functionality"
        title: "Android Debuggable Enabled in Production"
        description: "Application has debugging enabled which exposes internal data"
        remediation: "Set android:debuggable='false' for production builds"
        confidence_base: 0.95

  android_allowbackup:
    patterns:
      - id: "manifest_backup_001"
        pattern: "android:allowBackup\\s*=\\s*[\"']true[\"']"
        severity: "MEDIUM"
        cwe_id: "CWE-200"
        owasp_category: "M2: Insecure Data Storage"
        title: "Android allowBackup Enabled"
        description: "Application allows backup of sensitive data"
        remediation: "Set android:allowBackup='false' or implement backup restrictions"
        confidence_base: 0.9

      # Missing backup rules/restrictions
      - id: "manifest_backup_002"
        pattern: "android:allowBackup\\s*=\\s*[\"']true[\"'](?!.*android:backupAgent)"
        severity: "HIGH"
        cwe_id: "CWE-200"
        owasp_category: "M2: Insecure Data Storage"
        title: "Backup Enabled Without Agent"
        description: "Backup is enabled but no backup agent specified to control what gets backed up"
        remediation: "Implement a backup agent or disable backup entirely"
        confidence_base: 0.85

      # Full backup allowed without restrictions
      - id: "manifest_backup_003"
        pattern: "android:fullBackupContent\\s*=\\s*[\"']true[\"']|<full-backup-content>\\s*</full-backup-content>"
        severity: "MEDIUM"
        cwe_id: "CWE-200"
        owasp_category: "M2: Insecure Data Storage"
        title: "Unrestricted Full Backup"
        description: "Full backup is enabled without proper content restrictions"
        remediation: "Configure backup rules to exclude sensitive files"
        confidence_base: 0.8

  exported_components:
    patterns:
      - id: "manifest_exported_001"
        pattern: "android:exported\\s*=\\s*[\"']true[\"'][^>]*(?:receiver|service|activity|provider)"
        severity: "MEDIUM"
        cwe_id: "CWE-926"
        owasp_category: "M6: Insecure Authorization"
        title: "Unprotected Exported Component"
        description: "Component is exported without proper permission controls"
        remediation: "Add permission requirements or set exported='false'"
        confidence_base: 0.85

  custom_url_schemes:
    patterns:
      - id: "manifest_scheme_001"
        pattern: "android:scheme\\s*=\\s*[\"'][^\"']*[\"'][^>]*intent-filter"
        severity: "MEDIUM"
        cwe_id: "CWE-939"
        owasp_category: "M6: Insecure Authorization"
        title: "Custom URL Scheme Without Validation"
        description: "Custom URL scheme may allow unauthorized access"
        remediation: "Implement proper input validation for custom schemes"
        confidence_base: 0.8

# ========================================
# INSECURE DATA STORAGE PATTERNS
# ========================================

insecure_storage:
  shared_preferences_insecure:
    patterns:
      - id: "storage_prefs_001"
        pattern: "getSharedPreferences\\s*\\([^)]*\\)\\.edit\\(\\)\\.put(?:String|Int|Boolean|Float|Long)\\s*\\([^)]*(?:password|token|key|secret|credential)[^)]*\\)"
        severity: "HIGH"
        cwe_id: "CWE-200"
        owasp_category: "M2: Insecure Data Storage"
        title: "Insecure Shared Preferences Storage"
        description: "Sensitive data stored in unencrypted shared preferences"
        remediation: "Use EncryptedSharedPreferences for sensitive data"
        confidence_base: 0.9
      
      - id: "storage_prefs_002"
        pattern: "MODE_WORLD_READABLE|MODE_WORLD_WRITABLE"
        severity: "HIGH"
        cwe_id: "CWE-732"
        owasp_category: "M2: Insecure Data Storage"
        title: "World Accessible Shared Preferences"
        description: "Shared preferences accessible by other applications"
        remediation: "Use MODE_PRIVATE for shared preferences"
        confidence_base: 0.95

  sqlite_insecure:
    patterns:
      - id: "storage_sqlite_001"
        pattern: "openOrCreateDatabase\\s*\\([^)]*,\\s*0\\s*,\\s*null\\s*\\)"
        severity: "MEDIUM"
        cwe_id: "CWE-312"
        owasp_category: "M2: Insecure Data Storage"
        title: "Unencrypted SQLite Database"
        description: "SQLite database created without encryption"
        remediation: "Use SQLCipher or Android's EncryptedFile for database encryption"
        confidence_base: 0.85

      - id: "storage_sqlite_002"
        pattern: "CREATE TABLE[^)]*(?:password|token|key|secret|credential|pin|ssn|credit)"
        severity: "HIGH"
        cwe_id: "CWE-312"
        owasp_category: "M2: Insecure Data Storage"
        title: "Sensitive Data in SQLite Schema"
        description: "Database schema contains sensitive data fields"
        remediation: "Encrypt sensitive data before storing in database"
        confidence_base: 0.9

  external_storage:
    patterns:
      - id: "storage_external_001"
        pattern: "getExternalStorageDirectory\\(\\)|Environment\\.getExternalStorageDirectory\\(\\)"
        severity: "MEDIUM"
        cwe_id: "CWE-200"
        owasp_category: "M2: Insecure Data Storage"
        title: "External Storage Usage"
        description: "Data stored on external storage accessible by other apps"
        remediation: "Store sensitive data in internal storage only"
        confidence_base: 0.8

      - id: "storage_external_002"
        pattern: "Environment\\.getExternalStorageState\\(\\)\\s*==\\s*Environment\\.MEDIA_MOUNTED"
        severity: "MEDIUM"
        cwe_id: "CWE-200"
        owasp_category: "M2: Insecure Data Storage"
        title: "External Storage State Check"
        description: "Code checking external storage availability may lead to insecure storage"
        remediation: "Ensure sensitive data is not stored on external storage"
        confidence_base: 0.7

  temp_files:
    patterns:
      - id: "storage_temp_001"
        pattern: "File\\.createTempFile\\s*\\([^)]*\\)|new File\\s*\\([^)]*\"/tmp/\"[^)]*\\)"
        severity: "MEDIUM"
        cwe_id: "CWE-379"
        owasp_category: "M2: Insecure Data Storage"
        title: "Insecure Temporary File Creation"
        description: "Temporary files may contain sensitive data"
        remediation: "Use secure temporary file creation and cleanup"
        confidence_base: 0.75

  cache_storage:
    patterns:
      - id: "storage_cache_001"
        pattern: "FileOutputStream\\s*\\(\\s*new\\s+File\\s*\\([^)]*getCacheDir\\(\\)[^)]*\\)\\)"
        severity: "HIGH"
        cwe_id: "CWE-200"
        owasp_category: "M2: Insecure Data Storage"
        title: "Sensitive Data in Cache Directory"
        description: "Writing potentially sensitive data to cache directory"
        remediation: "Avoid storing sensitive data in cache directories"
        confidence_base: 0.8

      - id: "storage_cache_002"
        pattern: "Context\\.getFilesDir\\(\\)\\s*/\\s*\"[^\"]*\"\\s*"
        severity: "MEDIUM"
        cwe_id: "CWE-200"
        owasp_category: "M2: Insecure Data Storage"
        title: "Predictable Internal File Path"
        description: "Writing to predictable internal file paths"
        remediation: "Use secure file naming and proper access controls"
        confidence_base: 0.7

  database_storage:
    patterns:
      - id: "storage_db_001"
        pattern: "db\\.execSQL\\s*\\(\\s*\"CREATE TABLE.*TEXT\"\\s*\\)"
        severity: "MEDIUM"
        cwe_id: "CWE-312"
        owasp_category: "M2: Insecure Data Storage"
        title: "Unencrypted Database Table"
        description: "Database table created without encryption"
        remediation: "Use SQLCipher or encrypt sensitive columns"
        confidence_base: 0.8

      - id: "storage_db_002"
        pattern: "editor\\.apply\\(\\)\\s*;\\s*//\\s*no encryption"
        severity: "HIGH"
        cwe_id: "CWE-312"
        owasp_category: "M2: Insecure Data Storage"
        title: "Unencrypted SharedPreferences"
        description: "SharedPreferences applied without encryption comment"
        remediation: "Use EncryptedSharedPreferences for sensitive data"
        confidence_base: 0.9

# ========================================
# INSECURE LOGGING PATTERNS
# ========================================

insecure_logging:
  android_log:
    patterns:
      - id: "logging_android_001"
        pattern: "Log\\.[edvwi]\\s*\\([^)]*(?:password|token|key|secret|credential|pin|ssn|credit)[^)]*\\)"
        severity: "HIGH"
        cwe_id: "CWE-532"
        owasp_category: "M10: Extraneous Functionality"
        title: "Sensitive Data in Android Logs"
        description: "Highly sensitive information logged to Android Log system"
        remediation: "Remove sensitive data from log statements"
        confidence_base: 0.95

      - id: "logging_android_002"
        pattern: "System\\.out\\.print(?:ln)?\\s*\\([^)]*(?:password|token|key|secret|credential|pin|ssn|credit)[^)]*\\)"
        severity: "HIGH"
        cwe_id: "CWE-532"
        owasp_category: "M10: Extraneous Functionality"
        title: "Sensitive Data in System Output"
        description: "Highly sensitive information printed to system output"
        remediation: "Remove sensitive data from print statements"
        confidence_base: 0.95

      - id: "logging_android_003"
        pattern: "Log\\.[edvwi]\\s*\\([^)]*(?:password|token|key|secret|credential|pin|ssn|credit)[^)]*\\+[^)]*\\)"
        severity: "MEDIUM"
        cwe_id: "CWE-532"
        owasp_category: "M10: Extraneous Functionality"
        title: "Sensitive Data Concatenation in Android Logs"
        description: "Sensitive data concatenation in log statements may expose sensitive information"
        remediation: "Avoid logging sensitive data with concatenation"
        confidence_base: 0.8

      - id: "logging_android_004"
        pattern: "System\\.out\\.print(?:ln)?\\s*\\([^)]*(?:password|token|key|secret|credential|pin|ssn|credit)[^)]*\\+[^)]*\\)"
        severity: "MEDIUM"
        cwe_id: "CWE-532"
        owasp_category: "M10: Extraneous Functionality"
        title: "Sensitive Data Concatenation in System Output"
        description: "Sensitive data concatenation in print statements may expose sensitive information"
        remediation: "Avoid printing sensitive data with concatenation"
        confidence_base: 0.8

  cross_platform_logging:
    patterns:
      # Java logging frameworks
      - id: "logging_slf4j_001"
        pattern: "logger\\.debug\\(\".*(?:password|secret|token|key).*\"\\)"
        severity: "MEDIUM"
        cwe_id: "CWE-532"
        owasp_category: "M7: Client Code Quality"
        title: "SLF4J Debug Logging of Secrets"
        description: "SLF4J logger debugging sensitive information"
        remediation: "Remove sensitive data from debug logs"
        confidence_base: 0.9

      - id: "logging_slf4j_002"
        pattern: "logger\\.error\\(\"Exception\",\\s*ex\\)"
        severity: "MEDIUM"
        cwe_id: "CWE-532"
        owasp_category: "M7: Client Code Quality"
        title: "Exception Object Logging"
        description: "Logging exception object may expose stack trace with sensitive data"
        remediation: "Log exception messages without full stack traces in production"
        confidence_base: 0.7

      # Python logging
      - id: "logging_python_001"
        pattern: "traceback\\.print_exc\\(\\)"
        severity: "MEDIUM"
        cwe_id: "CWE-532"
        owasp_category: "M7: Client Code Quality"
        title: "Python Traceback Leak"
        description: "Python traceback may expose sensitive information"
        remediation: "Use structured logging instead of raw tracebacks"
        confidence_base: 0.8

      # JavaScript logging
      - id: "logging_js_001"
        pattern: "console\\.error\\(\".*(?:password|secret|token).*\"\\)"
        severity: "MEDIUM"
        cwe_id: "CWE-532"
        owasp_category: "M7: Client Code Quality"
        title: "JavaScript Console Logging"
        description: "JavaScript console logging sensitive information"
        remediation: "Remove sensitive data from console logs"
        confidence_base: 0.9

      # Go logging
      - id: "logging_go_001"
        pattern: "fmt\\.Printf\\(\".*(?:password|token).*\"\\)"
        severity: "MEDIUM"
        cwe_id: "CWE-532"
        owasp_category: "M7: Client Code Quality"
        title: "Go Printf Logging"
        description: "Go fmt.Printf logging sensitive information"
        remediation: "Use structured logging without sensitive data"
        confidence_base: 0.9

# ========================================
# CRYPTOGRAPHIC VULNERABILITIES
# ========================================

crypto_patterns:
  weak_hash_algorithms:
    patterns:
      # Fixed: Much more specific MD5 pattern requiring cryptographic context
      - id: "crypto_md5_001"
        pattern: "MessageDigest\\.getInstance\\s*\\([\"']MD5[\"']\\)|Mac\\.getInstance\\s*\\([\"'].*MD5.*[\"']\\)|(?:MD5|md5)(?:Hash|Digest|Algorithm|Utils|MessageDigest)\\s*\\(|new\\s+MD5(?:Hash|Digest)\\s*\\(|Hashing\\.md5\\s*\\("
        severity: "MEDIUM"
        cwe_id: "CWE-327"
        owasp_category: "M5: Insufficient Cryptography"
        title: "Weak Hash Algorithm: MD5"
        description: "Use of cryptographically weak MD5 hash algorithm in cryptographic operations"
        remediation: "Replace MD5 with SHA-256 or stronger hash algorithms"
        confidence_base: 0.95

      # Fixed: Much more specific SHA-1 pattern requiring cryptographic context
      - id: "crypto_sha1_001"
        pattern: "MessageDigest\\.getInstance\\s*\\([\"']SHA-?1[\"']\\)|Mac\\.getInstance\\s*\\([\"'].*SHA-?1.*[\"']\\)|(?:SHA1|sha1)(?:Hash|Digest|Algorithm|Utils|MessageDigest)\\s*\\(|new\\s+SHA1(?:Hash|Digest)\\s*\\(|Hashing\\.sha1\\s*\\("
        severity: "MEDIUM"  
        cwe_id: "CWE-327"
        owasp_category: "M5: Insufficient Cryptography"
        title: "Weak Hash Algorithm: SHA-1"
        description: "Use of cryptographically weak SHA-1 hash algorithm"
        remediation: "Replace SHA-1 with SHA-256 or stronger hash algorithms"
        confidence_base: 0.9

  weak_ciphers:
    patterns:
      # Fixed: Much more specific DES pattern with proper context
      - id: "crypto_des_001"
        pattern: "Cipher\\.getInstance\\s*\\(\\s*[\"'].*?(?:DES|3DES|TripleDES).*?[\"']\\s*\\)|SecretKeyFactory\\.getInstance\\s*\\(\\s*[\"'].*?(?:DES|3DES).*?[\"']\\s*\\)|Algorithm\\s*=\\s*[\"'].*?(?:DES|3DES).*?[\"']|new\\s+(?:DES|TripleDES)Key\\s*\\("
        severity: "HIGH"
        cwe_id: "CWE-327"
        owasp_category: "M5: Insufficient Cryptography"
        title: "Weak Encryption Algorithm: DES/3DES"
        description: "Use of weak DES or 3DES encryption in cryptographic operations"
        remediation: "Use AES-256 or other modern encryption algorithms"
        confidence_base: 0.95

      # Fixed: RC4 pattern with proper context
      - id: "crypto_rc4_001"
        pattern: "Cipher\\.getInstance\\s*\\(\\s*[\"'].*?(?:RC4|ARC4|ARCFOUR).*?[\"']\\s*\\)|Algorithm\\s*=\\s*[\"'].*?(?:RC4|ARC4|ARCFOUR).*?[\"']|new\\s+RC4\\s*\\("
        severity: "HIGH"
        cwe_id: "CWE-327"
        owasp_category: "M5: Insufficient Cryptography"
        title: "Weak Encryption Algorithm: RC4"
        description: "Use of broken RC4 stream cipher in cryptographic operations"
        remediation: "Use AES-256 or other modern encryption algorithms"
        confidence_base: 0.95

      # Advanced cipher configuration issues
      - id: "crypto_cipher_001"
        pattern: "Cipher\\.getInstance\\s*\\(\\s*\"AES/(?:CBC|GCM)?\\(?:NoPadding|PKCS5Padding\\)\"\\s*\\)"
        severity: "HIGH"
        cwe_id: "CWE-327"
        owasp_category: "M5: Insufficient Cryptography"
        title: "Insecure AES Configuration"
        description: "AES cipher configuration may have padding or IV issues"
        remediation: "Use AES/GCM/NoPadding or AES/CBC/PKCS7Padding with proper IV"
        confidence_base: 0.8

      - id: "crypto_pbe_001"
        pattern: "SecretKeyFactory\\.getInstance\\s*\\(\\s*\"(?:PBEWithMD5AndDES)\"\\s*\\)"
        severity: "HIGH"
        cwe_id: "CWE-327"
        owasp_category: "M5: Insufficient Cryptography"
        title: "Weak Password-Based Encryption"
        description: "Weak PBE algorithm using MD5 and DES"
        remediation: "Use PBKDF2 with SHA-256 and AES"
        confidence_base: 0.9

      - id: "crypto_keygen_001"
        pattern: "KeyPairGenerator\\.getInstance\\s*\\(\\s*\"(?:DSA|DiffieHellman)\"\\s*\\)"
        severity: "MEDIUM"
        cwe_id: "CWE-327"
        owasp_category: "M5: Insufficient Cryptography"
        title: "Weak Key Generation Algorithm"
        description: "Potentially weak key generation algorithm"
        remediation: "Use RSA with 2048+ bits or EC with 256+ bits"
        confidence_base: 0.8

      # Random number generation issues
      - id: "crypto_random_001"
        pattern: "\\bSecureRandom\\.getInstance\\(\"SHA1PRNG\"\\)"
        severity: "MEDIUM"
        cwe_id: "CWE-338"
        owasp_category: "M5: Insufficient Cryptography"
        title: "Weak Random Number Generator"
        description: "SHA1PRNG is not cryptographically secure on all platforms"
        remediation: "Use platform default SecureRandom() constructor"
        confidence_base: 0.8

      # MAC algorithm issues
      - id: "crypto_mac_001"
        pattern: "Mac\\.getInstance\\s*\\(\\s*\"(?:HmacMD5|HmacSHA1)\"\\s*\\)"
        severity: "MEDIUM"
        cwe_id: "CWE-327"
        owasp_category: "M5: Insufficient Cryptography"
        title: "Weak MAC Algorithm"
        description: "Weak HMAC algorithm using MD5 or SHA-1"
        remediation: "Use HmacSHA256 or stronger HMAC algorithms"
        confidence_base: 0.9

      # IV issues
      - id: "crypto_iv_001"
        pattern: "\\bnew\\s+IvParameterSpec\\s*\\(\\s*new\\s+byte\\[\\]\\s*\\{[^}]*\\}"
        severity: "HIGH"
        cwe_id: "CWE-329"
        owasp_category: "M5: Insufficient Cryptography"
        title: "Zero or Empty IV"
        description: "Initialization Vector (IV) is zero or empty"
        remediation: "Generate random IV for each encryption operation"
        confidence_base: 0.95

  hardcoded_keys:
    patterns:
      - id: "crypto_hardcode_001"
        pattern: "(?:private|secret|key).*=.*[\"'][a-zA-Z0-9+/]{20,}[\"']"
        severity: "HIGH"
        cwe_id: "CWE-798"
        owasp_category: "M5: Insufficient Cryptography"
        title: "Hardcoded Cryptographic Key"
        description: "Cryptographic keys hardcoded in source code"
        remediation: "Use secure key storage like Android Keystore"
        confidence_base: 0.8

      # Enhanced comprehensive crypto patterns
      - id: "crypto_ecb_001"
        pattern: "AES/ECB/"
        severity: "HIGH"
        cwe_id: "CWE-327"
        owasp_category: "M5: Insufficient Cryptography"
        title: "AES ECB Mode Usage"
        description: "AES ECB mode is cryptographically insecure"
        remediation: "Use AES with CBC or GCM modes instead of ECB"
        confidence_base: 0.95

      - id: "crypto_math_random_001"
        pattern: "Math\\.random\\s*\\(\\s*\\)"
        severity: "HIGH"
        cwe_id: "CWE-338"
        owasp_category: "M5: Insufficient Cryptography"
        title: "Cryptographically Weak Random"
        description: "Math.random() is not cryptographically secure"
        remediation: "Use SecureRandom for cryptographic operations"
        confidence_base: 0.9

      - id: "crypto_ssl_001"
        pattern: "SSLContext\\.getInstance\\s*\\(\\s*\"(?:SSL|SSLv2|SSLv3|TLS|TLSv1|TLSv1\\.1)\"\\s*\\)"
        severity: "HIGH"
        cwe_id: "CWE-327"
        owasp_category: "M4: Insecure Communication"
        title: "Weak SSL/TLS Protocol"
        description: "Use of weak or deprecated SSL/TLS protocol version"
        remediation: "Use TLSv1.2 or TLSv1.3 minimum"
        confidence_base: 0.95

      - id: "crypto_trustmanager_001"
        pattern: "X509TrustManager.*checkServerTrusted.*\\{\\s*\\}"
        severity: "HIGH"
        cwe_id: "CWE-295"
        owasp_category: "M4: Insecure Communication"
        title: "SSL Certificate Validation Disabled"
        description: "X509TrustManager with empty checkServerTrusted method"
        remediation: "Implement proper certificate validation"
        confidence_base: 0.95

      # Smali crypto patterns  
      - id: "crypto_smali_001"
        pattern: "const-string\\s+v\\d+,\\s*\"(?:MD5|SHA1|MD2|MD4|DES|RC4|RC2|SHA-1)\""
        severity: "MEDIUM"
        cwe_id: "CWE-327"
        owasp_category: "M5: Insufficient Cryptography"
        title: "Weak Crypto Algorithm in Smali"
        description: "Weak cryptographic algorithm found in Smali bytecode"
        remediation: "Use strong cryptographic algorithms"
        confidence_base: 0.9

      - id: "crypto_base64_001"
        pattern: "Base64\\.encode.*password"
        severity: "HIGH"
        cwe_id: "CWE-326"
        owasp_category: "M5: Insufficient Cryptography"
        title: "Password Encoded with Base64"
        description: "Password encoded with Base64 instead of proper hashing"
        remediation: "Use bcrypt, PBKDF2, or Argon2 for password hashing"
        confidence_base: 0.9

# ========================================
# INPUT VALIDATION VULNERABILITIES
# ========================================

input_validation:
  sql_injection:
    patterns:
      # Basic Android SQL injection with concatenation
      - id: "input_sql_001"
        pattern: "execSQL\\s*\\([^)]*\\+[^)]*\\)|rawQuery\\s*\\([^)]*\\+[^)]*\\)"
        severity: "HIGH"
        cwe_id: "CWE-89"
        owasp_category: "M7: Client Code Quality"
        title: "SQL Injection Vulnerability"
        description: "Dynamic SQL construction vulnerable to injection"
        remediation: "Use parameterized queries or prepared statements"
        confidence_base: 0.9

      # StringBuilder SQL construction (AndroGoat pattern) - Multi-line detection
      - id: "input_sql_002" 
        pattern: "StringBuilder.*append\\s*\\(.*(?:SELECT|INSERT|UPDATE|DELETE).*\\)"
        severity: "HIGH"
        cwe_id: "CWE-89"
        owasp_category: "M7: Client Code Quality"
        title: "SQL Injection via StringBuilder"
        description: "SQL query construction using StringBuilder with user input"
        remediation: "Use parameterized queries instead of string concatenation"
        confidence_base: 0.85
        
      # StringBuilder with user input (separate pattern for multi-line detection)
      - id: "input_sql_002b"
        pattern: "sb\\.append\\s*\\([^)]*getText\\s*\\(\\s*\\)\\.toString\\s*\\(\\s*\\)\\s*\\)"
        severity: "HIGH"
        cwe_id: "CWE-89"
        owasp_category: "M7: Client Code Quality"
        title: "User Input in StringBuilder SQL"
        description: "User input (getText) appended to StringBuilder for SQL query"
        remediation: "Use parameterized queries instead of string concatenation"
        confidence_base: 0.9
        
      # rawQuery with StringBuilder variable (includes method calls with $ characters)
      - id: "input_sql_002c"
        pattern: "(?:[a-zA-Z0-9_$]+\\.)?rawQuery\\s*\\(\\s*(?:sb[0-9]*|[a-zA-Z0-9_$]+)\\s*,\\s*null\\s*\\)"
        severity: "HIGH"
        cwe_id: "CWE-89"
        owasp_category: "M7: Client Code Quality"
        title: "SQL Injection via rawQuery with StringBuilder"
        description: "rawQuery executed with StringBuilder variable without parameters"
        remediation: "Use parameterized queries with selection arguments"
        confidence_base: 0.95
        
      # Broader rawQuery patterns for comprehensive detection
      - id: "input_sql_002d"
        pattern: "(?:[a-zA-Z0-9_$]+\\.)?rawQuery\\s*\\(\\s*(?:[a-zA-Z0-9_$]+|new\\s+StringBuilder\\([^)]*\\)\\.toString\\(\\)|\"[^\"]*\")\\s*,\\s*(?:null|[a-zA-Z0-9_$]+\\s*\\[\\s*\\])\\s*\\)"
        severity: "HIGH"
        cwe_id: "CWE-89"
        owasp_category: "M7: Client Code Quality"  
        title: "SQL Injection via rawQuery (Comprehensive)"
        description: "rawQuery executed with dynamic content without proper parameterization"
        remediation: "Use parameterized queries with selection arguments"
        confidence_base: 0.9
        
      # execSQL with dynamic content
      - id: "input_sql_002e"
        pattern: "(?:[a-zA-Z0-9_$]+\\.)?execSQL\\s*\\(\\s*(?:[a-zA-Z0-9_$]+|new\\s+StringBuilder\\([^)]*\\)\\.toString\\(\\)|\"[^\"]*\")\\s*\\)"
        severity: "HIGH"
        cwe_id: "CWE-89"
        owasp_category: "M7: Client Code Quality"
        title: "SQL Injection via execSQL"
        description: "execSQL executed with dynamic content"
        remediation: "Use parameterized queries instead of dynamic SQL construction"
        confidence_base: 0.9

      # Detect rawQuery/execSQL with pre-built dynamic strings
      - id: "input_sql_003"
        pattern: "rawQuery\\s*\\(\\s*[a-zA-Z_][a-zA-Z0-9_]*\\s*,\\s*null\\s*\\)|execSQL\\s*\\(\\s*[a-zA-Z_][a-zA-Z0-9_]*\\s*\\)"
        severity: "MEDIUM"
        cwe_id: "CWE-89"
        owasp_category: "M7: Client Code Quality"
        title: "Potential SQL Injection with Dynamic String"
        description: "SQL execution with variable string (check if dynamically constructed)"
        remediation: "Ensure string variables contain parameterized queries"
        confidence_base: 0.7

      # Advanced SQL injection patterns - comprehensive coverage
      - id: "input_sql_004"
        pattern: "Statement\\s+stmt\\s*=\\s*connection\\.createStatement\\(\\)\\s*;.*?stmt\\.execute\\("
        severity: "HIGH"
        cwe_id: "CWE-89"
        owasp_category: "M1: Improper Platform Usage"
        title: "Dynamic Statement Execution"
        description: "Dynamic SQL statement execution without parameterization"
        remediation: "Use PreparedStatement with parameter binding"
        confidence_base: 0.9

      - id: "input_sql_005"
        pattern: "\\.executeQuery\\s*\\(\\s*\".*\"\\s*\\+\\s*\\w+\\s*\\)"
        severity: "HIGH"
        cwe_id: "CWE-89"
        owasp_category: "M1: Improper Platform Usage"
        title: "Dynamic executeQuery"
        description: "Dynamic SQL in executeQuery method"
        remediation: "Use parameterized queries with ? placeholders"
        confidence_base: 0.95

      - id: "input_sql_006"
        pattern: "\\bexecuteUpdate\\s*\\(\\s*\".*\"\\s*\\+\\s*\\w+\\s*\\)"
        severity: "HIGH"
        cwe_id: "CWE-89"
        owasp_category: "M1: Improper Platform Usage"
        title: "Dynamic executeUpdate"
        description: "Dynamic SQL in executeUpdate method"
        remediation: "Use parameterized queries with ? placeholders"
        confidence_base: 0.95

      - id: "input_sql_007"
        pattern: "EntityManager\\.createNativeQuery\\([^)]*\\+[^)]*\\)"
        severity: "HIGH"
        cwe_id: "CWE-89"
        owasp_category: "M1: Improper Platform Usage"
        title: "JPA Native Query Injection"
        description: "JPA native query with string concatenation"
        remediation: "Use parameterized native queries or JPQL"
        confidence_base: 0.9
        
      # WHERE/AND/OR concatenations
      - id: "input_sql_008"
        pattern: "(?:WHERE|AND|OR)\\s+[A-Za-z0-9_]+\\s*=\\s*\"[^\"]*\"\\s*\\+\\s*\\w+"
        severity: "HIGH"
        cwe_id: "CWE-89"
        owasp_category: "M1: Improper Platform Usage"
        title: "SQL Injection in WHERE Clause"
        description: "Dynamic WHERE/AND/OR clause construction vulnerable to injection"
        remediation: "Use parameterized queries with ? placeholders"
        confidence_base: 0.9
        
      # LIKE-clause concatenations
      - id: "input_sql_009"
        pattern: "LIKE\\s*\"[^\"]*\"\\s*\\+\\s*\\w+"
        severity: "HIGH"
        cwe_id: "CWE-89"
        owasp_category: "M1: Improper Platform Usage"
        title: "SQL Injection in LIKE Clause"
        description: "Dynamic LIKE clause construction vulnerable to injection"
        remediation: "Use parameterized queries with ? placeholders"
        confidence_base: 0.9
        
      # String.format SQL patterns
      - id: "input_sql_010"
        pattern: "String\\.format\\s*\\(\\s*\"[^\"]*(?:SELECT|INSERT|UPDATE|DELETE)[^\"]*\"\\s*,\\s*[^)]+\\)"
        severity: "HIGH"
        cwe_id: "CWE-89"
        owasp_category: "M1: Improper Platform Usage"
        title: "SQL Injection via String.format"
        description: "SQL query constructed using String.format with user input"
        remediation: "Use parameterized queries instead of String.format"
        confidence_base: 0.9
        
      # Direct concatenation in getReadableDatabase()
      - id: "input_sql_011"
        pattern: "getReadableDatabase\\(\\)\\.\\s*(?:rawQuery|execSQL)\\s*\\(\\s*\"[^\"]*\"\\s*\\+\\s*\\w+"
        severity: "HIGH"
        cwe_id: "CWE-89"
        owasp_category: "M1: Improper Platform Usage"
        title: "SQL Injection in Database Query"
        description: "Direct concatenation in database query methods"
        remediation: "Use parameterized queries with selection arguments"
        confidence_base: 0.95

  webview_vulnerabilities:
    patterns:
      - id: "input_webview_001"
        pattern: "setJavaScriptEnabled\\s*\\(\\s*true\\s*\\)"
        severity: "MEDIUM"
        cwe_id: "CWE-79"
        owasp_category: "M7: Client Code Quality"
        title: "WebView JavaScript Enabled"
        description: "WebView has JavaScript enabled without proper validation"
        remediation: "Disable JavaScript or implement proper input validation"
        confidence_base: 0.8

      - id: "input_webview_002"
        pattern: "loadUrl\\s*\\([^)]*\\+[^)]*\\)|loadData\\s*\\([^)]*\\+[^)]*\\)"
        severity: "HIGH"
        cwe_id: "CWE-79"
        owasp_category: "M7: Client Code Quality"
        title: "WebView Dynamic Content Loading"
        description: "WebView loading dynamic content without validation"
        remediation: "Validate and sanitize all dynamic content"
        confidence_base: 0.85

# ========================================
# NETWORK SECURITY PATTERNS
# ========================================

network_security:
  certificate_pinning:
    patterns:
      - id: "network_pin_001"
        pattern: "hostnameVerifier\\s*\\(\\s*ALLOW_ALL_HOSTNAME_VERIFIER\\s*\\)|setHostnameVerifier\\s*\\([^)]*null[^)]*\\)"
        severity: "HIGH"
        cwe_id: "CWE-295"
        owasp_category: "M4: Insecure Communication"
        title: "Certificate Validation Disabled"
        description: "Certificate validation bypassed in network communication"
        remediation: "Enable proper certificate validation and pinning"
        confidence_base: 0.9

  cleartext_http:
    patterns:
      # Basic HTTP usage
      - id: "network_http_001"
        pattern: "http://(?!localhost|127\\.0\\.0\\.1)"
        severity: "MEDIUM"
        cwe_id: "CWE-319"
        owasp_category: "M4: Insecure Communication"
        title: "Unencrypted HTTP Communication"
        description: "Application uses unencrypted HTTP communication"
        remediation: "Use HTTPS for all network communication"
        confidence_base: 0.8

      # Advanced cleartext patterns
      - id: "network_http_002"
        pattern: "new\\s+URL\\s*\\(\\s*\"http://[^\"]+\"\\s*\\)"
        severity: "HIGH"
        cwe_id: "CWE-319"
        owasp_category: "M4: Insecure Communication"
        title: "HTTP URL Construction"
        description: "HTTP URL constructed in code"
        remediation: "Use HTTPS URLs for all network communication"
        confidence_base: 0.9

      - id: "network_http_003"
        pattern: "HttpURLConnection.*http://"
        severity: "HIGH"
        cwe_id: "CWE-319"
        owasp_category: "M4: Insecure Communication"
        title: "HTTP URLConnection"
        description: "HttpURLConnection using HTTP protocol"
        remediation: "Use HTTPS with HttpsURLConnection"
        confidence_base: 0.9

      # WebSocket cleartext
      - id: "network_ws_001"
        pattern: "\\bws://[^\"']+"
        severity: "HIGH"
        cwe_id: "CWE-319"
        owasp_category: "M4: Insecure Communication"
        title: "Cleartext WebSocket"
        description: "WebSocket connection over cleartext"
        remediation: "Use WSS (WebSocket Secure) protocol"
        confidence_base: 0.95

      # FTP cleartext
      - id: "network_ftp_001"
        pattern: "Request\\.Builder.*url\\s*\\(\\s*\"ftp://[^\"]*\"\\s*\\)"
        severity: "HIGH"
        cwe_id: "CWE-319"
        owasp_category: "M4: Insecure Communication"
        title: "Insecure FTP URL"
        description: "FTP URL in request builder"
        remediation: "Use SFTP or FTPS for secure file transfer"
        confidence_base: 0.9

      # REST/HTTP client patterns
      - id: "network_rest_001"
        pattern: "RestTemplate\\.getForEntity\\s*\\(\\s*\"http://[^\"]+\"\\s*\\)"
        severity: "HIGH"
        cwe_id: "CWE-319"
        owasp_category: "M4: Insecure Communication"
        title: "REST Template HTTP Usage"
        description: "RestTemplate using HTTP protocol"
        remediation: "Use HTTPS endpoints in RestTemplate"
        confidence_base: 0.9

      # Headers with hardcoded hosts
      - id: "network_header_001"
        pattern: "@Headers\\s*\\(\\s*\"\\s*Host:\\s*[^\"]+\"\\s*\\)"
        severity: "MEDIUM"
        cwe_id: "CWE-319"
        owasp_category: "M4: Insecure Communication"
        title: "Hardcoded Host Header"
        description: "Hardcoded Host header in HTTP request"
        remediation: "Use dynamic host configuration"
        confidence_base: 0.7

      # Android manifest cleartext
      - id: "network_manifest_001"
        pattern: "android:usesCleartextTraffic=\"true\""
        severity: "HIGH"
        cwe_id: "CWE-319"
        owasp_category: "M4: Insecure Communication"
        title: "Cleartext Traffic Enabled"
        description: "Android manifest allows cleartext traffic"
        remediation: "Set usesCleartextTraffic to false and use HTTPS"
        confidence_base: 0.95

      # JavaScript fetch API
      - id: "network_fetch_001"
        pattern: "fetch\\s*\\(\\s*\"http://[^\"]+\"\\s*\\)"
        severity: "HIGH"
        cwe_id: "CWE-319"
        owasp_category: "M4: Insecure Communication"
        title: "JavaScript Fetch HTTP"
        description: "JavaScript fetch API using HTTP"
        remediation: "Use HTTPS in fetch requests"
        confidence_base: 0.9

# ========================================
# ROOT AND EMULATOR DETECTION
# ========================================

detection_patterns:
  root_detection:
    patterns:
      # Fixed: Much more specific root detection pattern
      - id: "detect_root_001"
        pattern: "(?:Process\\.exec|Runtime\\.getRuntime\\(\\)\\.exec)\\s*\\(.*?\"(?:su\\s|/system/xbin/su|/system/bin/su|which\\s+su)\"|RootTools\\.|superuser\\s*(?:\\(|\\.|=)|isRooted\\s*\\(|checkRoot\\s*\\(|\\bsu\\s+(?:-c|--command)"
        severity: "INFO"
        cwe_id: "CWE-200"
        owasp_category: "M10: Extraneous Functionality"
        title: "Root Detection Implementation"
        description: "Application implements root detection mechanisms"
        remediation: "Ensure root detection is properly implemented"
        confidence_base: 0.85

  emulator_detection:
    patterns:
      - id: "detect_emu_001"
        pattern: "goldfish|emulator|android_x86|genymotion"
        severity: "INFO"
        cwe_id: "CWE-200"
        owasp_category: "M10: Extraneous Functionality"  
        title: "Emulator Detection Implementation"
        description: "Application implements emulator detection mechanisms"
        remediation: "Ensure emulator detection is robust"
        confidence_base: 0.7

# ========================================
# COMPREHENSIVE HARDCODED SECRETS PATTERNS
# ========================================

code_quality:
  hardcoded_secrets:
    patterns:
    # Basic hardcoded credentials
    - id: "secrets_basic_001"
      pattern: "String\\s+(?:password|secret|key|token|api_key|apikey|access_key|secret_key|private_key|jwt|bearer)\\s*=\\s*\"([^\"]{6,})\""
      severity: "CRITICAL"
      cwe_id: "CWE-798"
      owasp_category: "M7: Client Code Quality"
      title: "Hardcoded Secret in String Variable"
      description: "Hardcoded secret found in string variable declaration"
      remediation: "Use secure credential storage mechanisms like Android Keystore"

    # Fixed: More specific promo code pattern
    - id: "secrets_promo_001"
      pattern: "(?:String\\s+(?:promo|promocode|coupon|voucher)\\s*=\\s*\"[A-Z0-9]{6,}\"|(?:promo|promocode|voucher|coupon)_?(?:code|key)\\s*=\\s*\"[^\"]{4,}\"|element\\s*=\\s*\"[A-Z0-9]{8,}\")(?!.*(?:example|test|debug|placeholder|sample|demo))"
      severity: "MEDIUM"
      cwe_id: "CWE-798"
      owasp_category: "M7: Client Code Quality"
      title: "Hardcoded Promotional Code"
      description: "Hardcoded promotional or access code found"
      remediation: "Store codes securely and validate them server-side"

    # Fixed: More specific context-based pattern with exclusions
    - id: "secrets_generic_001"
      pattern: "(?:String\\s+(?:password|secret|key|token|api_key|auth_token)\\s*=\\s*\"[^\"]{8,}\"|final\\s+.*?(?:password|secret|key|token).*?=\\s*\"[^\"]{8,}\"|\\.(setText|setPassword)\\s*\\(\\s*\"[A-Za-z0-9+/=]{12,}\"\\s*\\))(?!.*(?:example|test|debug|placeholder|sample|demo))"
      severity: "MEDIUM"
      cwe_id: "CWE-798"
      owasp_category: "M7: Client Code Quality"
      title: "Potential Hardcoded Credential Value"
      description: "Hardcoded credential-like value that may contain sensitive information"
      remediation: "Use secure credential storage instead of hardcoded values"
      confidence_base: 0.85

    - id: "secrets_basic_002"
      pattern: "final\\s+String\\s+(?:password|username|secret|key|token|auth_token|api_token|session_token)\\s*=\\s*\"([^\"]+)\""
      severity: "CRITICAL"
      cwe_id: "CWE-798"
      owasp_category: "M7: Client Code Quality"
      title: "Hardcoded Final String Credential"
      description: "Hardcoded credential in final string declaration"
      remediation: "Use secure credential storage mechanisms like Android Keystore"
      confidence_base: 0.95

    # Cloud provider API keys
    - id: "secrets_aws_001"
      pattern: "\\b(?:AWS|AZURE|GCP)_?(?:ACCESS_KEY_ID|SECRET_ACCESS_KEY)\\b\\s*=\\s*\"[^\"]{16,}\""
      severity: "CRITICAL"
      cwe_id: "CWE-798"
      owasp_category: "M7: Client Code Quality"
      title: "Cloud Provider API Key"
      description: "Hardcoded cloud provider API key detected"
      remediation: "Use environment variables or secure credential storage"
      confidence_base: 0.95

    - id: "secrets_google_001"
      pattern: "AIza[0-9A-Za-z\\-_]{35}"
      severity: "CRITICAL"
      cwe_id: "CWE-798"
      owasp_category: "M7: Client Code Quality"
      title: "Google API Key"
      description: "Hardcoded Google API key detected"
      remediation: "Use secure API key storage and restrict API key usage"
      confidence_base: 0.98

    - id: "secrets_oauth_001"
      pattern: "ya29\\.[0-9A-Za-z\\-_]+"
      severity: "CRITICAL"
      cwe_id: "CWE-798"
      owasp_category: "M7: Client Code Quality"
      title: "OAuth 2.0 Bearer Token"
      description: "Hardcoded OAuth 2.0 bearer token detected"
      remediation: "Use secure token storage and implement token refresh"
      confidence_base: 0.95

    # SSH and certificate keys
    - id: "secrets_ssh_001"
      pattern: "ssh-rsa\\s+[A-Za-z0-9+/]{100,}"
      severity: "HIGH"
      cwe_id: "CWE-798"
      owasp_category: "M7: Client Code Quality"
      title: "Embedded SSH Public Key"
      description: "SSH public key embedded in source code"
      remediation: "Remove SSH keys from source code and use secure key management"
      confidence_base: 0.9

    - id: "secrets_private_key_001"
      pattern: "-----BEGIN (?:RSA|EC) PRIVATE KEY-----[\\s\\S]+?-----END (?:RSA|EC) PRIVATE KEY-----"
      severity: "CRITICAL"
      cwe_id: "CWE-798"
      owasp_category: "M7: Client Code Quality"
      title: "Embedded Private Key"
      description: "Private key embedded in source code"
      remediation: "Remove private keys from source code and use secure key storage"
      confidence_base: 0.98

    # Service-specific tokens
    - id: "secrets_slack_001"
      pattern: "\\bSLACK_[A-Z0-9]{24}\\b"
      severity: "HIGH"
      cwe_id: "CWE-798"
      owasp_category: "M7: Client Code Quality"
      title: "Slack Legacy Token"
      description: "Hardcoded Slack legacy token detected"
      remediation: "Use OAuth tokens and secure storage"
      confidence_base: 0.9

    - id: "secrets_facebook_001"
      pattern: "\\bEAACEdEose0cBA[0-9A-Za-z]+?\\b"
      severity: "HIGH"
      cwe_id: "CWE-798"
      owasp_category: "M7: Client Code Quality"
      title: "Facebook Access Token"
      description: "Hardcoded Facebook access token detected"
      remediation: "Use OAuth flow and secure token storage"
      confidence_base: 0.9

    - id: "secrets_stripe_001"
      pattern: "\\bpk_live_[A-Za-z0-9]{24}\\b"
      severity: "CRITICAL"
      cwe_id: "CWE-798"
      owasp_category: "M7: Client Code Quality"
      title: "Stripe Live API Key"
      description: "Hardcoded Stripe live API key detected"
      remediation: "Use environment variables and secure credential storage"
      confidence_base: 0.95

    # JWT tokens and advanced patterns
    - id: "secrets_jwt_001"
      pattern: "\"[A-Za-z0-9+/]{36,}\\.eyJ[A-Za-z0-9+/=]+\\.[A-Za-z0-9+/=_-]+\""
      severity: "CRITICAL"
      cwe_id: "CWE-798"
      owasp_category: "M7: Client Code Quality"
      title: "Hardcoded JWT Token"
      description: "JWT token hardcoded in source code"
      remediation: "Use secure token storage and implement token refresh"
      confidence_base: 0.98

    # Database URLs with credentials
    - id: "secrets_db_001"
      pattern: "(?:jdbc:|mongodb:|redis:).*://.*:[^@/]*@"
      severity: "CRITICAL"
      cwe_id: "CWE-798"
      owasp_category: "M7: Client Code Quality"
      title: "Database URL with Embedded Credentials"
      description: "Database connection string contains embedded credentials"
      remediation: "Use secure credential storage and connection pooling"
      confidence_base: 0.95

    - id: "secrets_postgres_001"
      pattern: "\"(?:postgres|mysql|oracle)://[^:]*:[^@]*@[^\"]*\""
      severity: "CRITICAL"
      cwe_id: "CWE-798"
      owasp_category: "M7: Client Code Quality"
      title: "Database Connection String with Credentials"
      description: "Database connection string contains hardcoded credentials"
      remediation: "Use secure credential storage and connection pooling"
      confidence_base: 0.95

    # Smali bytecode patterns
    - id: "secrets_smali_001"
      pattern: "const-string\\s+v\\d+,\\s*\"(?:password|secret|key|token|api_key|auth_key|jwt|bearer)[^\"]*\""
      severity: "HIGH"
      cwe_id: "CWE-798"
      owasp_category: "M7: Client Code Quality"
      title: "Smali Hardcoded Secret Keyword"
      description: "Hardcoded secret keyword found in Smali bytecode"
      remediation: "Use secure credential storage mechanisms"
      confidence_base: 0.9

    - id: "secrets_smali_002"
      pattern: "const-string\\s+v\\d+,\\s*\"[A-Za-z0-9+/]{16,}={0,2}\""
      severity: "MEDIUM"
      cwe_id: "CWE-798"
      owasp_category: "M7: Client Code Quality"
      title: "Smali Base64-like String"
      description: "Base64-like string in Smali bytecode potentially containing secret"
      remediation: "Verify if string contains sensitive data and secure appropriately"
      confidence_base: 0.7

    - id: "secrets_smali_003"
      pattern: "\\.field.*(?:password|secret|key|token|api_key|auth|jwt).*:Ljava/lang/String;"
      severity: "HIGH"
      cwe_id: "CWE-798"
      owasp_category: "M7: Client Code Quality"
      title: "Smali Secret Field Declaration"
      description: "Secret-related field declaration in Smali bytecode"
      remediation: "Use secure credential storage mechanisms"
      confidence_base: 0.85

    # Context-specific patterns for potential secrets
    - id: "secrets_generic_001"
      pattern: "(?:private|secret|api).*(?:key|token).*=\\s*\"[A-Za-z0-9]{32,64}\"|(?:API_KEY|SECRET_KEY|PRIVATE_KEY)\\s*=\\s*\"[A-Za-z0-9]{20,}\""
      severity: "HIGH"
      cwe_id: "CWE-798"
      owasp_category: "M7: Client Code Quality"
      title: "Context-Based Potential Secret"
      description: "Potential secret detected based on variable naming context"
      remediation: "Use secure credential storage mechanisms"
      confidence_base: 0.85

    - id: "secrets_hex_001"
      pattern: "(?:secret|key|token|password|hash).*=\\s*\"[a-fA-F0-9]{32,64}\"|(?:SECRET|KEY|TOKEN|PASSWORD|HASH).*=\\s*\"[a-fA-F0-9]{32,64}\""
      severity: "HIGH"
      cwe_id: "CWE-798"
      owasp_category: "M7: Client Code Quality"
      title: "Hardcoded Hex Secret with Context"
      description: "Long hexadecimal string in secret-related context"
      remediation: "Use secure credential storage mechanisms"
      confidence_base: 0.9

# ========================================
# GENERIC CREDENTIAL PATTERNS (Legacy)
# ========================================

credential_patterns:
  hardcoded_credentials:
    patterns:
      - id: "cred_001"
        pattern: "(?:password|passwd|pwd|secret|token|key)\\s*[:=]\\s*[\"'][^\"']{8,}[\"']"
        severity: "CRITICAL"
        cwe_id: "CWE-798"
        owasp_category: "M10: Extraneous Functionality"
        title: "Hardcoded Credentials"
        description: "Hardcoded credentials found in source code"
        remediation: "Use secure credential storage mechanisms like Android Keystore"
        confidence_base: 0.85

# ========================================
# CONFIGURATION
# ========================================

# Organic file type filters - no app-specific paths
file_filters:
  include_extensions:
    - ".java"
    - ".kt"
    - ".xml"
    - ".properties"
    - ".smali"
  exclude_paths:
    # Framework libraries - generic exclusions only
    - "androidx/"
    - "com/google/"
    - "org/apache/"
    - "kotlin/"
    - "kotlinx/"
  focus_application_code: true

# Deduplication settings
deduplication:
  enabled: true
  similarity_threshold: 0.85
  hash_fields:
    - "file_path"
    - "line_number" 
    - "pattern"
    - "vulnerable_code"

# Context extraction
context_extraction:
  enabled: true
  lines_before: 5
  lines_after: 5
  min_confidence: 0.7