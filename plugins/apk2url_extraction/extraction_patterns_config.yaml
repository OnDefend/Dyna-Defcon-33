# APK2URL Extraction Plugin - External Configuration
# Extraction patterns, noise filters, validation rules, and security assessment criteria

# URL Pattern Definitions
url_patterns:
  standard_http:
    pattern: "https?://[a-zA-Z0-9\\-\\.]+\\.[a-zA-Z]{2,}(?:/[^\\s\"'<>]*)?"
    flags: "IGNORECASE"
    confidence: 0.95
    description: "Standard HTTP/HTTPS URLs with domain validation"
    
  ftp_urls:
    pattern: "ftp://[a-zA-Z0-9\\-\\.]+(?:/[^\\s\"'<>]*)?"
    flags: "IGNORECASE"
    confidence: 0.90
    description: "FTP protocol URLs"
    
  websocket_urls:
    pattern: "wss?://[a-zA-Z0-9\\-\\.]+\\.[a-zA-Z]{2,}(?:/[^\\s\"'<>]*)?"
    flags: "IGNORECASE"
    confidence: 0.90
    description: "WebSocket URLs (ws/wss)"
    
  custom_scheme:
    pattern: "[a-z][a-z0-9+.-]*://[^\\s\"'<>]+"
    flags: "IGNORECASE"
    confidence: 0.75
    description: "Custom scheme URLs"

# IP Address Pattern Definitions  
ip_patterns:
  ipv4_standard:
    pattern: "(?:^|[^\\d])(\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})(?:[^\\d]|$)"
    confidence: 0.85
    description: "Standard IPv4 addresses"
    
  ipv6_standard:
    pattern: "(?:^|[^\\w:])((?:[0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4})(?:[^\\w:]|$)"
    confidence: 0.80
    description: "Standard IPv6 addresses"

# Domain Pattern Definitions
domain_patterns:
  standard_domain:
    pattern: "(?:^|[^\\w\\-\\.])([a-zA-Z0-9\\-]+\\.(?:[a-zA-Z]{2,}|[a-zA-Z]{2}\\.[a-zA-Z]{2}))(?:[^\\w\\-\\.]|$)"
    flags: "IGNORECASE"
    confidence: 0.80
    description: "Standard domain names with TLD validation"

# API Endpoint Patterns
api_patterns:
  versioned_api:
    pattern: "/api/v?\\d+/[a-zA-Z0-9\\-_/]+"
    flags: "IGNORECASE"
    confidence: 0.90
    description: "Versioned API endpoints"
    
  rest_endpoints:
    pattern: "/rest/[a-zA-Z0-9\\-_/]+"
    flags: "IGNORECASE"
    confidence: 0.85
    description: "REST service endpoints"
    
  service_endpoints:
    pattern: "/service/[a-zA-Z0-9\\-_/]+"
    flags: "IGNORECASE"
    confidence: 0.85
    description: "Service endpoints"
    
  graphql_endpoints:
    pattern: "/graphql[/?]?"
    flags: "IGNORECASE"
    confidence: 0.95
    description: "GraphQL endpoints"

# Framework Noise Filter Patterns
framework_noise_patterns:
  flutter_framework:
    patterns:
      - "^(ThemeData|PointerSignalKind|ImageRepeat|FloatingCursor)"
      - "(pointer|hover|vertex|stack|frame)\\."
      - "(change|event|listener|handler)\\."
      - "\\.dart$"
      - "gradient\\.dart|layout\\.dart"
    description: "Flutter framework patterns that generate false positives"
    
  react_native:
    patterns:
      - "react[\\-/]?native"
      - "node_modules/"
      - "@react-native"
    description: "React Native framework noise"
    
  android_framework:
    patterns:
      - "menu\\.MenuBuilder"
      - "^(framework|core|base|util)\\."
      - "(component|widget|element)\\."
    description: "Android framework patterns"
    
  memory_binary:
    patterns:
      - "(alloc|malloc|stack|heap|memory)"
      - "(corrupt|segv|fault|dump)"
    description: "Memory and binary operation patterns"
    
  package_references:
    patterns:
      - "^(com|org|net|io)\\.[a-z0-9\\.]+$"
      - "^[a-z]+[A-Z][a-zA-Z]*\\("
    description: "Package and class reference patterns"
    
  xml_schema_noise:
    patterns:
      - "^http://schemas\\.android\\.com/apk/res"
      - "^http://schemas\\.android\\.com/apk/res-auto"
      - "xmlns:"
      - "objectAnimator.*set.*"
      - "shape.*solid.*"
      - "include.*layout.*"
    description: "XML schema definitions that are not actual endpoints"
    
  ui_animation_noise:
    patterns:
      - "(objectAnimator|pathData|iconFade)"
      - "(translationZ|colorSeconda|Container)"
    description: "UI and animation framework patterns"

# File Path Exclusions
excluded_file_patterns:
  asset_files:
    patterns:
      - "/assets/"
      - "/res/raw/"
      - "/assets/flutter_assets/"
    description: "Asset directories that typically contain noise"
    
  binary_files:
    patterns:
      - "/lib/[^/]+\\.so$"
      - "\\.(?:png|jpg|jpeg|gif|webp|svg)$"
    description: "Binary files that shouldn't be text-analyzed"
    
  framework_directories:
    patterns:
      - "flutter/"
      - "react-native/"
      - "node_modules/"
      - "/META-INF/"
    description: "Framework-specific directories"

# Invalid IP Address Patterns
invalid_ip_patterns:
  ipv6_fragments:
    patterns:
      - "^::[0-9a-fA-F]{0,3}$"
      - "^::$"
    description: "Invalid IPv6 fragments"
    
  version_numbers:
    patterns:
      - "^[0-9]+\\.[0-9]+\\.[0-9]+\\.[0-9]+$"
    description: "Version numbers that look like IPs"

# Security Risk Assessment Rules
security_risk_rules:
  critical_indicators:
    secret_patterns:
      - "(?i)(password|passwd|pwd|secret|key|token|auth)\\s*[=:]\\s*['\"]?[a-zA-Z0-9+/=]{8,}"
      - "(?i)(api[_-]?key|access[_-]?token|secret[_-]?key)\\s*[=:]\\s*['\"]?[a-zA-Z0-9+/=]{16,}"
    credentials:
      - "(?i)(username|login|user)\\s*[=:]\\s*['\"]?[a-zA-Z0-9@._-]{3,}"
    
  high_risk_indicators:
    cleartext_protocols:
      - "http://"
      - "ftp://"
      - "telnet://"
    hardcoded_ips:
      - "\\b(?:[0-9]{1,3}\\.){3}[0-9]{1,3}\\b"
    
  medium_risk_indicators:
    development_domains:
      - "(?i)(test|dev|development|staging|localhost)"
    suspicious_tlds:
      - "\\.(tk|ml|ga|cf)$"

# Domain Categorization Rules
domain_categorization:
  development:
    keywords: ["dev", "development", "devel", "debug"]
    risk_level: "medium"
    
  testing:
    keywords: ["test", "testing", "qa", "quality", "sandbox"]
    risk_level: "medium"
    
  staging:
    keywords: ["staging", "stage", "uat", "pre-prod", "preprod"]
    risk_level: "medium"
    
  localhost:
    keywords: ["localhost", "127.0.0.1", "0.0.0.0", "local"]
    risk_level: "low"
    
  suspicious:
    keywords: ["debug", "temp", "tmp", "admin", "backdoor", "internal"]
    risk_level: "high"

# Processing Limits Configuration
processing_limits:
  file_size:
    max_file_size_mb: 50
    skip_large_files: true
    
  dex_processing:
    max_dex_files: 3  # Reduced from 5 to 3 for faster processing
    max_strings_per_dex: 5000  # Reduced from 10000 to 5000
    
  resource_processing:
    max_resource_files: 50  # Reduced from 100 to 50
    max_xml_depth: 5  # Reduced from 10 to 5
    
  native_lib_processing:
    max_native_libs: 10  # Reduced from 20 to 10
    max_binary_scan_size: 524288  # Reduced from 1MB to 512KB
    
  timing:
    max_processing_time: 180  # Reduced from 300 to 180 seconds (3 minutes)
    timeout_per_file: 15      # Reduced from 30 to 15 seconds per file

# Validation Rules
validation_rules:
  url_validation:
    min_length: 10
    max_length: 2048
    require_domain: true
    valid_schemes: ["http", "https", "ftp", "ws", "wss"]
    
  ip_validation:
    ipv4_ranges:
      private:
        - "10.0.0.0/8"
        - "172.16.0.0/12" 
        - "192.168.0.0/16"
      reserved:
        - "127.0.0.0/8"
        - "169.254.0.0/16"
        - "224.0.0.0/4"
    
  domain_validation:
    min_parts: 2
    max_part_length: 63
    valid_characters: "a-zA-Z0-9-"
    invalid_start_end: "-"

# MASVS Control Mappings
masvs_mappings:
  network_communication:
    control: "MSTG-NETWORK-01"
    description: "Network Communication"
    applicable_types: ["url", "api_endpoint", "domain"]
    
  network_requests:
    control: "MSTG-NETWORK-02"
    description: "Network Requests"
    applicable_types: ["ip_address", "url"]
    
  platform_apis:
    control: "MSTG-PLATFORM-03"
    description: "Platform APIs"
    applicable_types: ["deep_link", "file_url"]
    
  cryptographic_key_management:
    control: "MSTG-CRYPTO-01"
    description: "Cryptographic Key Management"
    applicable_types: ["secret", "certificate"]

# Confidence Calculation Factors
confidence_factors:
  pattern_reliability:
    explicit_url: 0.95
    domain_with_tld: 0.90
    ip_address: 0.85
    api_pattern: 0.80
    custom_scheme: 0.70
    
  context_relevance:
    manifest_file: 1.0
    config_file: 0.9
    resource_file: 0.8
    dex_code: 0.7
    binary_data: 0.6
    
  validation_coverage:
    syntax_valid: 0.3
    context_appropriate: 0.3
    not_framework_noise: 0.4
    
  extraction_method:
    structured_data: 0.9
    regex_pattern: 0.8
    binary_search: 0.6
    heuristic: 0.5

# Output Formatting Configuration
output_formatting:
  display_limits:
    max_items_per_category: 20
    max_item_length: 80
    truncation_suffix: "..."
    
  categorization:
    priority_order:
      - "secrets"
      - "urls"
      - "api_endpoints" 
      - "ips"
      - "domains"
      - "deep_links"
      - "file_urls"
      - "certificates"
    
  risk_colors:
    critical: "red"
    high: "bright_red"
    medium: "yellow"
    low: "green"
    info: "blue"

# Plugin Metadata
plugin_metadata:
  name: "APK2URL Endpoint Discovery"
  version: "2.0.0"
  description: "Comprehensive URL, IP address, and endpoint extraction from APK files"
  masvs_controls:
    - "MSTG-NETWORK-01"
    - "MSTG-NETWORK-02"
    - "MSTG-PLATFORM-03"
    - "MSTG-CRYPTO-01"
  risk_level: "MEDIUM"
  analysis_mode: "safe"
  category: "network" 